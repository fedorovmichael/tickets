var typeNameValueDictionary={},subTypeNameValueDictionary={};$(document).on({ajaxStart:function(){$("#divLoading").addClass("wait-modal"),$("#divLoading").removeClass("wait-modal-none")},ajaxComplete:function(){$("#divLoading").removeClass("wait-modal"),$("#divLoading").addClass("wait-modal-none"),$("body").scrollTop(0)}}),$(document).ready(function(){$("input[id^='typeID_']").on("click",function(){filtersHandler()}),$("input[id^='subTypeID_']").on("click",function(){filtersHandler()}),$("input[id^='regionID_']").on("click",function(){regionsFilterHandler(this.id)}),$("input[id^='cbCity_']").on("click",function(){citiesFilterHandler(this.id)}),$("body").on("click","li[id^='liMainShowID_']",function(){var b=$(this).attr("showcode");$("#hdnEditShowID").val(""),$("#hdnEditShowID").val(b),editShowHandler(this.id,b)}),$("#txtSearch").on("keyup",function(){searchShowByText($("#txtSearch").val())}),$("#liSortByPrice").on("click",function(a){a.preventDefault(),sortByHandler("liSortByPrice","spanSortByPriceAlt_desc","spanSortByPrice_asc")}),$("#liSortByName").on("click",function(a){a.preventDefault(),sortByHandler("liSortByName","spanSortByNameAlt_desc","spanSortByName_asc")}),$("#liSortBySection").on("click",function(a){a.preventDefault(),sortByHandler("liSortBySection","spanSortBySectionAlt_desc","spanSortBySection_asc")}),$("#liSortByDate").on("click",function(a){a.preventDefault(),sortByHandler("liSortByDate","spanSortByDateAlt_desc","spanSortByDate_asc")}),$("#liSuperPrice").on("click",function(){filtersHandler()}),$("#liDiscount").on("click",function(){filtersHandler()}),$("#liTour").on("click",function(){filtersHandler()}),$("#btnEditShowClose").on("click",function(){editClose()}),$("#txtDateFrom").on("change",function(){var b=$("#txtDateFrom").val(),e=!0;if(0<b.length&&(e=validateData(b)),!e)return alert("wrong date! "),!1;var f=$("#txtDateTo").datepicker("getDate");(""==f||null==f)&&$("#txtDateTo").datepicker("setDate",$("#txtDateFrom").datepicker("getDate")),leftFilterDateHandler(!0)}),$("#txtDateTo").on("change",function(){var b=$("#txtDateTo").val(),e=!0;return 0<b.length&&(e=validateData(b)),e?void leftFilterDateHandler(!0):(alert("wrong date! "),!1)}),$("#aClearTopFilter").on("click",function(a){a.preventDefault(),clearTopFilter()}),$("#aClearLeftFilter").on("click",function(a){a.preventDefault(),clearLeftFilter()}),$("input[id^='inputLeftFilter_'").on("click",function(){leftFilterDateHandler(!1)}),$("#inputPriceMin").on("keyup",function(){this.value=this.value.replace(/[^0-9\.]/g,""),1<this.value.length&&leftFilterPriceHandler()}),$("#inputPriceMax").on("keyup",function(){this.value=this.value.replace(/[^0-9\.]/g,""),1<this.value.length&&leftFilterPriceHandler()}),$("body").on("click","a[id^='aSeancePay_']",function(a){a.preventDefault(),showSeancePayPage(this.id)}),$("#aCloseEditShow, #btnCloseEditShow").on("click",function(a){a.preventDefault(),editClose()}),$("#aBackToEdit").on("click",function(a){a.preventDefault(),$("#iframeSeancePayPage").prop("src",""),$("#divSeancePayPage").hide(),$("#divEditShowBody").show(),$("#aBackToEdit").hide()}),$("body").on("click","#btnShowMore",function(){var b=$("li[id^='liMainShowID_']");$("#liShowMore").hide(),$.each(b,function(e,f){$(f).show()})}),$("#aShowShareLink").on("click",function(a){a.preventDefault(),$("#lblShowShareLink").is(":visible")?$("#lblShowShareLink").hide():$("#lblShowShareLink").show()}),$("#aAboutPage, #aHomePage").on("click",function(){}),$("body").on("click","a[id^='aShowMedia']",function(a){a.preventDefault()}),$("#inpShowShareLink").on("focus",function(){this.select()}),$(window).scroll(function(){50<$(this).scrollTop()?$("#back-to-top").fadeIn():$("#back-to-top").fadeOut()}),$("#back-to-top").click(function(){return $("#back-to-top").tooltip("hide"),$("body,html").animate({scrollTop:0},800),!1}),$("#back-to-top").tooltip("show"),directLink(),$("#btnSendComment").on("click",function(){sendComment("creator",null)}),$("#aFocusCommentLink").on("click",function(a){a.preventDefault(),focusComments()})});function sortByHandler(a,b,e){$("#"+b).is(":visible")?($("#"+b).hide(),$("#"+e).show()):($("#"+b).show(),$("#"+e).hide()),$("#hdnSortElement").text(""),$("#hdnSortElement").text(a),filtersHandler()}function menuTypeHandler(){var b=$("li[id^='liTypeID_']"),e=[];$.each(b,function(k,l){var m=$(l).find("input[type='checkbox']"),o=$(m).is(":checked"),p=$(m).attr("id").split("_")[1];$("#subMenuOfType_"+p).hide(),o&&(e.push(p),$("#subMenuOfType_"+p).show())});var j={};j.ids=e.join(),sendDataToServer("/getShowsByType",j,menuTypeHandlerCallbackSuccess,null)}function createShowHTML(a){var e="",f=[],g=[],j="";$("#ulShows").empty(),$("#ulShows li").remove(),j=$("#hdnSelectedTypes").val(),g=j.split(","),$.each(a,function(k,l){var m=f.findIndex(J=>J===l.show_id);if(-1==m){f.push(l.show_id);var t="",u="",y="",z="",A="",B="";if(-1==g.findIndex(J=>J===l.type_id))B="<a href='#' type_id='"+l.type_id+"' style='background:"+l.type_color+";' class='top-category-of-event'>"+l.type_name+"</a>";else if("undefined"!=l.subcategory_name&&""!=l.subcategory_name&&"0"!=l.subtype_id){var C=l.subcategory_name.split("|");1<C.length?$.each(C,function(J,K){t+="<a href='#' subtype_id='"+l.subtype_id+"' style='background:"+l.type_color+";' class='top-category-of-event'>"+K+"</a>"}):t+="<a href='#' subtype_id='"+l.subtype_id+"' style='background:"+l.type_color+";' class='top-category-of-event'>"+l.subcategory_name+"</a>"}else B="<a href='#' type_id='"+l.type_id+"' style='background:"+l.type_color+";' class='top-category-of-event'>"+l.type_name+"</a>";var D=l.main_image.split("/"),E=D[D.length-1];if(u="bravo"==l.resource?"http://www.bilety.co.il/images/shows/"+E:"http://www.bilety.co.il/images/shows/"+E,50<l.name.length){var F=l.name.substr(0,50);y=F.substr(0,F.lastIndexOf(" "))}else y=l.name;z=$.datepicker.formatDate("dd.mm.yy",new Date(l.date_from)),A=$.datepicker.formatDate("dd.mm.yy",new Date(l.date_to));var G=z==A?z:z+" - "+A,H=l.price_min==l.price_max?l.price_min+"&#8362;":l.price_min+"&#8362; - "+l.price_max+"&#8362;",I="";40==k&&(e+="<li id='liShowMore' style='width:100%; text-align:center; padding-bottom:10px;'><button id='btnShowMore' style='cursor: pointer; text-transform: uppercase; color:black; width: 350px; margin-top: 20px;'>\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0435\u0449\u0451</button></li>"),40<=k&&(I="display:none;"),e+="<li id='liMainShowID_"+l.show_id+"' showCode='"+l.show_code+"' style='height: 285px; border: solid 0px red; cursor: pointer; "+I+" ' class='col-sm-3'><div><div class='text-left'>"+B+t+"</div><div class='thumbnail'><img id='imgShowMain_"+l.show_id+"' src='"+u+"' alt='' style='width: 198px; height: 110px;' onerror='handleImageError(this);'><div class='caption' style='padding:0px;'><h1 class='main-show-caption'>"+y+"</h1><p>"+G+"</p><p>\u0426\u0435\u043D\u0430 "+H+"</p></div></div></div></li>"}}),$("#ulShows").append(e)}function menuTypeHandlerCallbackSuccess(a){createShowHTML(a.shows,a.showsSections)}function editShowHandler(a,b){var e={};e.id=a.split("_")[1],e.showCode=b,sendDataToServer("/getShowByID",e,editShowHandlerCallbackSuccess,null)}function editShowHandlerCallbackSuccess(a){a.show!=void 0&&($("#divShowEdit").show(),$("#editShowModal").modal("show"),fillEditShowHTML(a.show,a.showSeances,a.showMedia,a.comments,a.recommendShows))}function editClose(){$("html head").find("title").text("\u0410\u0444\u0438\u0448\u0430 2017 - \u043A\u0443\u043F\u0438\u0442\u044C \u0431\u0438\u043B\u0435\u0442 \u043D\u0430 \u043A\u043E\u043D\u0446\u0435\u0440\u0442, \u0442\u0435\u0430\u0442\u0440 \u043E\u043D\u043B\u0430\u0439\u043D \u0432 \u0418\u0437\u0440\u0430\u0438\u043B\u0435 - BILETY.CO.IL"),$("meta[name='description']").attr("content","\u0421\u0430\u043C\u0430\u044F \u0431\u043E\u043B\u044C\u0448\u0430\u044F \u0430\u0444\u0438\u0448\u0430 \u0432 \u0418\u0437\u0440\u0430\u0438\u043B\u0435. \u041A\u0443\u0434\u0430 \u0441\u0445\u043E\u0434\u0438\u0442\u044C: \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044F \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043E\u0432, \u0432\u044B\u0441\u0442\u0430\u0432\u043E\u043A, \u0441\u043F\u0435\u043A\u0442\u0430\u043A\u043B\u0435\u0439, \u0433\u0430\u0441\u0442\u0440\u043E\u043B\u0435\u0439, \u0438\u0437\u0440\u0430\u0438\u043B\u044C\u0441\u043A\u0438\u0445 \u0442\u0435\u0430\u0442\u0440\u043E\u0432, \u0431\u0430\u043B\u0435\u0442\u0430, \u043E\u043F\u0435\u0440\u044B, \u0446\u0438\u0440\u043A\u0430, \u043A\u043B\u0443\u0431\u043D\u044B\u0445 \u0441\u043E\u0431\u044B\u0442\u0438\u0439 \u0438 \u0440\u0430\u0437\u0432\u043B\u0435\u0447\u0435\u043D\u0438\u0439 \u0434\u043B\u044F \u0434\u0435\u0442\u0435\u0439"),$("#divShowEdit").hide(),$("#editShowModal").modal("hide"),$("#iframeSeancePayPage").prop("src",""),$("#divSeancePayPage").hide(),$("#divEditShowBody").show(),$("#aBackToEdit").hide()}function fillEditShowHTML(a,b,e,f,g){var j="bravo"==a[0].resource?"http://kaccabravo.co.il":"http://biletru.co.il";$("html head").find("title").text(a[0].name+" - bilety.co.il"),$("meta[name='description']").attr("content",a[0].announce),$("#spanEditShowName").text(a[0].name),$("#lblShowShareLink").hide();decodeURIComponent(window.location.search.substring(1));$("#lblShowShareLink").text("");var l=window.location.port?":"+window.location.port:"",m=window.location.protocol+"//"+window.location.hostname+l+"/event/",o=m+a[0].show_code;$("#lblShowShareLink").text(o),$("#lblShowShareLink").attr("href",o),$("#imgEditMain").attr("src",j+a[0].main_image),$("#pEditShowAnnounce").text(a[0].announce);var p="";$.each(b,function(z,A){var D="";if(D=A.price_min==A.price_max||""==A.price_max?"<td>"+A.price_min+"&#8362;</td>":"<td>"+A.price_min+" - "+A.price_max+"&#8362;</td>",""!=A.price_max||""!=A.price_min){var E=$.datepicker.formatDate("dd.mm.yy",new Date(A.date)),F="aSeancePay_"+A.id,G="bravo"==a[0].resource?"<img src='/images/bravo-logo.jpg' alt='bravo' style='width: 35px; height: 25px;'>":"<img src='/images/biletru-logo.gif' alt='biletru' style='width: 55px; height: 15px;'>";p+="<tr><td>"+A.city+"</td><td>"+E+"&nbsp;"+A.seance_time+"</td><td>"+A.hall+"</td>"+D+"<td><a id='"+F+"' href='#' link='"+A.link+"' style='color: black; cursor: pointer;'> <span style='text-transform: uppercase;'> \u043A\u0443\u043F\u0438\u0442\u044C </span> &nbsp; "+G+" </a></td></tr>"}});var q=$("#tableEditSeances tr");$.each(q,function(z){0<z&&$(this).remove()}),$("#tableEditSeances").append(p);var r="";$.each(e,function(z,A){var C,D,B=new Image,E=180,F=180,G=0;B.src=j+A.link,B.id="imgShowMedia_"+A.id,B.onload=function(){C=this.width,D=this.height,C>E&&(G=E/C,$("#"+this.id).css("width",E),$("#"+this.id).css("height",D*G)),D>F&&(G=F/D,$("#"+this.id).css("height",F),$("#"+this.id).css("width",C*G))},r+="<div class='col-xs-6 col-md-3'><a id='aShowMedia_"+A.id+"' href='' class='thumbnail'><img id='imgShowMedia_"+A.id+"' src='"+j+A.link+"' alt='"+a[0].name+"'></img><a/></div>"}),$("#divEditGalary").empty(),$("#divEditGalary").append(r);var s="",t="\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438("+f.length+")";$("#spanCommentsCount").text(t),$.each(f,function(z,A){s+="<li class=\"comment-li\"><div id=\"divCommentHeader\" class=\"comment-left-mar-bottom5\"><img src=\"images/comment-avatar.jpg\" class=\"comment-avatar\"/><span id=\"spnCommentName\" style=\"margin-right:5px;\">"+A.name+"</span><span id=\"spnCommentDate\" style=\"\">"+$.datepicker.formatDate("dd.mm.yy",new Date(A.publish_date))+"</span></div><div id=\"divCommentBody\" class=\"comment-left-mar-bottom5\"><span id=\"spnCommentText\" style=\"\"> "+A.text+" </span></div><div id=\"divCommentFooter\" class=\"comment-div-footer\" style=\"display:none;\"><a id=\"aCommentReply_"+A.id+"\" commentID=\""+A.id+"\" reply=\"false\" style=\"cursor: pointer;\">\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C</a></div><div id=\"divCommentReplyForm_"+A.id+"\" style=\"margin-bottom:5px;\"></div></li>"}),$("#ulEditComments li").empty(),$("#ulEditComments li").remove(),$("#ulEditComments").append(s);var u=Ya.share2("divSocialShare",{content:{url:o,title:a[0].name,image:j+a[0].main_image,description:a[0].announce.split(".")[0]}}),y="";$.each(g,function(z,A){var B=A.main_image.split("/"),C=B[B.length-1],D="";if(50<A.name.length)var E=A.name.substr(0,50),D=E.substr(0,E.lastIndexOf(" "));else var D=A.name;var F=m+A.show_code;y+="<li style=\"float: left;\"><div class=\"thumbnail\"><a href=\""+F+"\"><img src=\"images/shows/"+C+"\" alt=\""+D+"\" title=\""+D+"\" class=\"main-show-image\" onerror=\"handleImageError(this);\"/></a></div><div class=\"caption\"><a href=\""+F+"\" class=\"a-link-general\"><h1 class=\"main-show-caption\">"+D+"</h1>","</a></div></li>"}),$("#ulRecommendShow li").empty(),$("#ulRecommendShow li").remove(),$("#ulRecommendShow").append(y)}function searchShowByText(a){(3<=a.length||0==a.length)&&filtersHandler()}function searchShowByTextCallbackSuccess(a){createShowHTML(a.shows,a.showsSections)}function filtersHandler(){var a=$("li[id^='liTypeID_']"),b=$("li[id^='liSubTypeID_']"),e=$("li[id^='liCity_']"),f=$("#txtDateFrom").datepicker("getDate"),g=$.datepicker.formatDate("dd.mm.yy",f),j=$("#txtDateTo").datepicker("getDate"),k=$.datepicker.formatDate("dd.mm.yy",j),l=[],m=[],q=$("#hdnDateFilterData").text(),r=$("#hdnCitiesFilterData").text(),s=$("#inputSuperPrice").is(":checked"),t=$("#inputDiscount").is(":checked"),u=$("#inputTour").is(":checked"),y=""==$("#inputPriceMin").val()?null:parseInt($("#inputPriceMin").val()),z=""==$("#inputPriceMax").val()?null:parseInt($("#inputPriceMax").val()),A=0,B=[];$.each(a,function(E,F){var G=$(F).find("input[type='checkbox']"),H=$(G).is(":checked"),I=$(G).attr("id"),J=$(G).attr("id").split("_")[1];if($("#subMenuOfType_"+J).hide(),H){$("#subMenuOfType_"+J).show();var K=$("#subMenuOfType_"+J+" li"),L=0;B.push(J),$.each(K,function(M,N){var O=$(N).find("input[type='checkbox']"),P=$(O).is(":checked"),Q=$(O).attr("id").split("_")[1];P&&(m.push(Q),$("#"+I).prop("checked",!1),$("label[for="+I+"]").removeClass("checked"),L++)}),l.push({type:J,subTypes:0==L?null:m.join()}),A++}}),0==A&&(l=null),$("#hdnSelectedTypes").val(""),$("#hdnSelectedTypes").val(B.join(",")),""==$("#hdnSortElement").text()&&$("#hdnSortElement").text("liSortByPrice");var C={cities:""==r?null:r,types:null==l?null:l,subtypes:m.join(),searchText:""==$("#txtSearch").val()?null:$("#txtSearch").val(),superPrice:s,discount:t,sortByPrice:"liSortByPrice"==$("#hdnSortElement").text()?getSortDirection("liSortByPrice"):null,sortByName:"liSortByName"==$("#hdnSortElement").text()?getSortDirection("liSortByName"):null,sortByDate:"liSortByDate"==$("#hdnSortElement").text()?getSortDirection("liSortByDate"):null,sortBySection:"liSortBySection"==$("#hdnSortElement").text()?getSortDirection("liSortBySection"):null,tour:u,dates:""==q?null:q,minPrice:y,maxPrice:z};sendDataToServer("/getShowByFilters",C,menuTypeHandlerCallbackSuccess,null)}function getSortDirection(a){var b=$("#"+a+" span"),e="";return $.each(b,function(f,g){$(g).is(":visible")&&$(g).hasClass("glyphicon")&&(e=$(g).attr("id").split("_")[1])}),e}function clearTopFilter(){$("#txtSearch").val(""),$("#liSuperPrice").removeClass("active"),$("#liDiscount").removeClass("active"),$("#liTour").removeClass("active"),$("#spanSortByPriceAlt_desc").show(),$("#spanSortByPrice_asc").hide(),$("#hdnSortElement").text(""),$("#hdnSortElement").text("liSortByPrice"),$("#spanSortByName_asc").show(),$("#spanSortByNameAlt_desc").hide();var a=$("li[id^='liCity_']");$.each(a,function(b,e){var f=$(e).find("input[type='checkbox']");$(f).prop("checked",!1),$("label[for="+$(f).attr("id")+"]").removeClass("checked")}),filtersHandler()}function clearLeftFilter(){var a=$("li[id^='liTypeID_']");$.each(a,function(b,e){var f=$(e).find("input[type='checkbox']");$(f).prop("checked",!1),$("label[for="+$(f).attr("id")+"]").removeClass("checked")}),a=$("li[id^='liSubTypeID_']"),$.each(a,function(b,e){var f=$(e).find("input[type='checkbox']");$(f).prop("checked",!1),$("label[for="+$(f).attr("id")+"]").removeClass("checked")}),a=$("li[id^='liCity_']"),$.each(a,function(b,e){var f=$(e).find("input[type='checkbox']");$(f).prop("checked",!1),$("label[for="+$(f).attr("id")+"]").removeClass("checked")}),a=$("li[id^='liRegion_']"),$.each(a,function(b,e){var f=$(e).find("input[type='checkbox']");$(f).prop("checked",!1),$("label[for="+$(f).attr("id")+"]").removeClass("checked");var g=$(e).attr("id").split("_")[1];$("#ulCitiesOfRegion_"+g).hide()}),$("#hdnCitiesFilterData").text(""),a=$("li[id^='liLeftFilter_']"),$.each(a,function(b,e){var f=$(e).find("input[type='checkbox']");$(f).prop("checked",!1),$("label[for="+$(f).attr("id")+"]").removeClass("checked")}),$("#hdnDateFilterData").text(""),$("#txtDateFrom").val(""),$("#txtDateTo").val(""),$("#txtDateFrom").prop("disabled",!1),$("#txtDateTo").prop("disabled",!1),$("#inputSuperPrice").prop("checked",!1),$("label[for='inputSuperPrice']").removeClass("checked"),$("#inputDiscount").prop("checked",!1),$("label[for='inputDiscount']").removeClass("checked"),$("#inputTour").prop("checked",!1),$("label[for='inputTour']").removeClass("checked"),$("#inputPriceMin").val(""),$("#inputPriceMax").val(""),filtersHandler()}function leftFilterDateHandler(a){var b=$("li[id^='liLeftFilter_']"),e=[];if($("#hdnSortElement").text("liSortByDate"),$("#spanSortByDateAlt_desc").is(":visible")&&($("#spanSortByDateAlt_desc").hide(),$("#spanSortByDate_asc").show()),$("#txtDateFrom").prop("disabled",!1),$("#txtDateTo").prop("disabled",!1),a){var f={},g=$("#txtDateFrom").datepicker("getDate");f.fDate=$.datepicker.formatDate("dd.mm.yy",g);var j=$("#txtDateTo").datepicker("getDate");f.tDate=$.datepicker.formatDate("dd.mm.yy",j),e.push(f)}else $.each(b,function(k,l){var m=$(l).find("input[type='checkbox']"),o=$(m).is(":checked"),p=$(l).attr("id").split("_")[1],q=new Date,r={};if(o)switch($("#txtDateFrom").prop("disabled","true"),$("#txtDateTo").prop("disabled","true"),$("#txtDateFrom").val(""),$("#txtDateTo").val(""),p.toLowerCase()){case"today":r.fDate=$.datepicker.formatDate("dd.mm.yy",q),r.tDate=$.datepicker.formatDate("dd.mm.yy",q),e.push(r);break;case"tomorrow":r.fDate=$.datepicker.formatDate("dd.mm.yy",new Date(q.getFullYear(),q.getMonth(),q.getDate()+1)),r.tDate=$.datepicker.formatDate("dd.mm.yy",new Date(q.getFullYear(),q.getMonth(),q.getDate()+1)),e.push(r);break;case"week":r.fDate=$.datepicker.formatDate("dd.mm.yy",q),r.tDate=$.datepicker.formatDate("dd.mm.yy",new Date(q.getFullYear(),q.getMonth(),q.getDate()+7)),e.push(r);break;case"weekend":var s=q.getDay(),t=4>q.getDay()?4:11,u=t-s;y=$.datepicker.formatDate("dd.mm.yy",new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()+u)),r.fDate=y,r.tDate=$.datepicker.formatDate("dd.mm.yy",new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()+u+2)),e.push(r);break;case"nextweekend":var y="",z="",s=q.getDay(),t=4>q.getDay()?11:18,A=t-s,B=new Date().getFullYear(),C=new Date().getMonth(),D=new Date().getDate()+A;y=$.datepicker.formatDate("dd.mm.yy",new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()+A)),z=$.datepicker.formatDate("dd.mm.yy",new Date(B,C,D+2)),r.fDate=y,r.tDate=z,e.push(r);break;case"month":r.fDate=$.datepicker.formatDate("dd.mm.yy",q),r.tDate=$.datepicker.formatDate("dd.mm.yy",new Date(q.getFullYear(),q.getMonth(),q.getDate()+30)),e=[],e.push(r);break;case"treemonth":r.fDate=$.datepicker.formatDate("dd.mm.yy",q),r.tDate=$.datepicker.formatDate("dd.mm.yy",new Date(q.getFullYear(),q.getMonth(),q.getDate()+90)),e=[],e.push(r);}});$("#hdnDateFilterData").text(JSON.stringify(e)),filtersHandler(e)}function regionsFilterHandler(a){var b=a.split("_")[1],e=[],f="",g={},j=[],k=$("input[id^='regionID_']");if(""!=$("#hdnCitiesFilterData").text()&&(j=JSON.parse($("#hdnCitiesFilterData").text())),$("#ulCitiesOfRegion_"+b).is(":visible")){$("#ulCitiesOfRegion_"+b).hide();var l=0;$.each(j,function(o,p){p.regionID==b&&(l=o)}),j.splice(l,1)}else $("#ulCitiesOfRegion_"+b).show(),f=$("#ulCitiesOfRegion_"+b+" li"),$.each(f,function(o,p){var q=$(p).prop("id").split("_")[1];e.push(q)}),g.regionID=b,g.cities=e,j.push(g);$("#hdnCitiesFilterData").text(""),$("#hdnCitiesFilterData").text(JSON.stringify(j));$("#hdnCitiesFilterData").text();filtersHandler()}function citiesFilterHandler(a){var b=$("#"+a).attr("region");$("label[for='regionID_"+b+"']").hasClass("checked")&&($("#regionID_"+b).prop("checked",!1),$("label[for='regionID_"+b+"']").removeClass("checked"));var e=JSON.parse($("#hdnCitiesFilterData").text());$.each(e,function(g,j){if(j.regionID==b){j.cities=[];var k=$("input[region='"+b+"']");$.each(k,function(l,m){$(m).is(":checked")&&j.cities.push($(m).attr("id").split("_")[1])}),0==j.cities.length&&$("#ulCitiesOfRegion_"+b).hide()}}),$("#hdnCitiesFilterData").text(""),$("#hdnCitiesFilterData").text(JSON.stringify(e));$("#hdnCitiesFilterData").text();filtersHandler()}function leftFilterPriceHandler(){var a=""==$("#inputPriceMin").val()?0:parseInt($("#inputPriceMin").val()),b=parseInt($("#inputPriceMax").val());a>b&&0!=b||filtersHandler()}function validateData(a){var b=new Date().getDate(),e=new Date().getMonth(),f=new Date().getFullYear(),g=!0;10!=a.length&&(g=!1);var j=a.split("/");if(3!=j.length)return!1;if(2!=j[0].length)return!1;var k=parseInt(j[0]);if(31<k||1>k||k<b&&j[1]==e)return!1;if(2!=j[1].length)return!1;var l=parseInt(j[1]);if(12<l||1>l||l<e&&j[2]==f)return!1;if(4<j[2].length)return!1;var m=parseInt(j[2]);return!(m<f)&&g}function showSeancePayPage(a){var b=$("#"+a).attr("link");$("#iframeSeancePayPage").prop("src",b),$("#divSeancePayPage").show(),$("#divEditShowBody").hide(),$("#aBackToEdit").show()}function imageSizeHandler(){arrImg=$("#divEditGalary img"),$.each(arrImg,function(){var e=$(this).width(),f=$(this).height()})}function directLink(){var a=decodeURIComponent(window.location.search.substring(1)),b=navigator.userAgent,e="",f="",g=window.location.href.split("/");loadTypeNameValueDictionary(),loadSubTypeNameValueDictionary();try{if("show"==a.split("=")[0]){var j=a.split("=")[1];editShowHandler("",j)}else if(3<g.length&&""!=g[3]){var k=4==g.length?1:2;switch(g[g.length-k]){case"":}if(e=typeNameValueDictionary[g[g.length-k]],4<g.length){f=subTypeNameValueDictionary[g[g.length-1]];var l="subTypeID_"+f;$("#"+l).prop("checked",!0),$("label[for="+l+"]").addClass("checked")}var m="typeID_"+e;$("#"+m).prop("checked",!0),$("label[for="+m+"]").addClass("checked"),filtersHandler()}}catch(o){console.log("directLink error: ",o)}}function handleImageError(a){$(a).attr("src","/images/default-image.jpg")}function sendComment(a,b){var e=$("#txtCommentName").val(),f=$("#txtCommentEmail").val(),g=$("#txtCommentText").val();if(!isValidEmail(f))return void alert("Email address not valid.");if(0==$.trim(e).length||0==$.trim(g).length)return void alert("Please fill name and text fields");var j={name:e,email:f,text:g,host:a,parentID:b,showCode:$("#hdnEditShowID").val()};sendDataToServer("/createComment",j,sendCommentCallbackSuccess,sendCommentCallbackError)}function sendCommentCallbackSuccess(){$("#txtCommentName").val(""),$("#txtCommentEmail").val(""),$("#txtCommentText").val(""),$("#divEditCommentFormAlertSuccess").show(),$("#divEditCommentFormAlertSuccess").delay(5e3).fadeOut(400);$("#divEditComments").html()}function sendCommentCallbackError(){$("#divEditCommentFormAlertError").show(),$("#divEditCommentFormAlertError").delay(5e3).fadeOut(400)}function isValidEmail(a){var b=new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);return b.test(a)}function loadCommentForm(a){closeReplyForms(),$("#aCommentReply_"+a).text("\u0417\u0430\u043A\u0440\u044B\u0442\u044C"),$("#aCommentReply_"+a).attr("reply","true");$("#divCommentReplyForm_"+a).html(""),$("#divCommentReplyForm_"+a).append("<div id=\"divCommentReplyForm\"><div id=\"divCommentFormReplyAlertSuccess\" style=\"display:none;\" class=\"alert alert-success\"><a href=\"#\" data-dismiss=\"alert\" aria-label=\"close\" class=\"close\">&times;</a><span>\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D \u043D\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u043F\u0440\u043E\u0435\u043A\u0442\u0430.</span></div><div id=\"divCommentFormReplyAlertError\" style=\"display:none;\" class=\"alert alert-danger\"><a href=\"#\" data-dismiss=\"alert\" aria-label=\"close\" class=\"close\">&times;</a><span>\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F.</span></div><ul style=\"width: 500px; margin:auto;\" class=\"row list-unstyled\"><li style=\"margin-bottom:5px;\"><input id=\"txtCommentName\" type=\"text\" placeholder=\"\u0418\u043C\u044F\" required=\"\" class=\"form-control\"/></li><li style=\"margin-bottom:5px;\"><input id=\"txtCommentEmail\" type=\"email\" name=\"email\" placeholder=\"Email\" required=\"\" class=\"form-control\"/></li><li style=\"margin-bottom:5px;\"><textarea id=\"txtCommentText\" type=\"text\" cols=\"40\" rows=\"5\" placeholder=\"\" required=\"\" class=\"form-control\"></textarea></li><li style=\"margin-bottom:5px;\"><button id=\"btnReplyComment_"+a+"\" parentID=\""+a+"\" type=\"button\" style=\"text-transform: uppercase; float: left;\" class=\"btn btn-default\">\u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C</button></li></ul></div>")}function closeReplyForms(){var a=$("div[id^='divCommentReplyForm_']");$.each(a,function(b,e){$(this).html("");var f=e.id.split("_")[1];$("a#aCommentReply_"+f).attr("reply","false"),$("a#aCommentReply_"+f).text("\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C")})}function loadTypeNameValueDictionary(){typeNameValueDictionary.concert="1",typeNameValueDictionary.theater="2",typeNameValueDictionary.circus="3",typeNameValueDictionary.humor="4",typeNameValueDictionary.children="5",typeNameValueDictionary.show="6",typeNameValueDictionary.meetings="7",typeNameValueDictionary.sport="8",typeNameValueDictionary.cinema="9",typeNameValueDictionary.exibitions="10"}function loadSubTypeNameValueDictionary(){subTypeNameValueDictionary.poprock="1",subTypeNameValueDictionary.stage="2",subTypeNameValueDictionary.hiphop="3",subTypeNameValueDictionary.jazzblues="4",subTypeNameValueDictionary.classic="5",subTypeNameValueDictionary.bard="6",subTypeNameValueDictionary.folk="7",subTypeNameValueDictionary.performances="8",subTypeNameValueDictionary.musical="9",subTypeNameValueDictionary.opera="10",subTypeNameValueDictionary.ballet="11",subTypeNameValueDictionary.comedy="12",subTypeNameValueDictionary.drama="13",subTypeNameValueDictionary.detective="14"}function focusComments(){$("#editShowModal").animate({scrollTop:$("#editShowModal").prop("scrollHeight")},1e3)}function sendDataToServer(a,b,e,f){try{$.ajax({url:a,contentType:"application/json",type:"POST",data:JSON.stringify(b),success:function(g){(null!=e||""!=e)&&e(g)},error:function(g){null!=f&&""!=f&&f(g)}})}catch(g){console.error("sendDataToServer error: ",g)}}